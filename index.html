<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Photo Upload</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1470&q=80') no-repeat center center fixed;
      background-size: cover;
      color: #333;
      min-height: 100vh;
      margin: 0;
    }
    #langToggle {
      cursor: pointer;
      background: rgba(255 255 255 / 0.85);
      border: none;
      border-radius: 24px;
      padding: 8px 16px;
      font-size: 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }
    #langToggle:hover {
      background: rgba(255 255 255 / 1);
    }
    #langToggle span.flag {
      font-size: 1.5rem;
    }
    h2 {
      background: rgba(255 255 255 / 0.8);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-top: 0;
    }
    input[type="file"] {
      font-size: 1.1rem;
      margin: 1rem 0 0.5rem 0;
      background: rgba(255 255 255 / 0.85);
      border-radius: 8px;
      padding: 6px 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    button#uploadBtn {
      font-size: 1.3rem;
      margin: 0.8rem 0 1.2rem 0;
      padding: 0.5rem 1.8rem;
      border-radius: 32px;
      border: none;
      background: #ff7070;
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(255,112,112,0.5);
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button#uploadBtn:hover {
      background: #ff4c4c;
    }
    #status {
      width: 320px;
      max-width: 90vw;
      background: rgba(255 255 255 / 0.85);
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      padding: 1rem;
      font-size: 1rem;
      color: #333;
      max-height: 150px;
      overflow-y: auto;
      display: flex;
      flex-direction: column-reverse;
      gap: 6px;
      white-space: nowrap;
    }
    #qrCode {
      margin-top: 1.5rem;
      background: rgba(255 255 255 / 0.9);
      padding: 10px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>
  <button id="langToggle"><span class="flag">ðŸ‡¬ðŸ‡§</span><span id="langText">Switch to English</span></button>
  <h2 id="heading">Upload your wedding photo</h2>
  <input type="file" id="fileInput" accept="image/*" multiple />
  <button id="uploadBtn">Upload</button>
  <div id="status"></div>
  <div id="qrCode"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getStorage, ref, uploadBytes } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCCCwPOV2Dh0zZnEWzIdHzAxOJP1kKR6sU",
      authDomain: "svadbafoto-22df5.firebaseapp.com",
      projectId: "svadbafoto-22df5",
      storageBucket: "svadbafoto-22df5.firebasestorage.app",
      messagingSenderId: "466308248816",
      appId: "1:466308248816:web:edf8f6920013d3fd227e35",
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    // Language state: start with English
    let lang = 'en';

    const texts = {
      sk: {
        uploadButton: 'NahraÅ¥',
        heading: 'Nahrajte vaÅ¡u svadobnÃº fotku',
        chooseFile: 'ðŸ“‚ ProsÃ­m vyberte aspoÅˆ jednu fotku.',
        unsupportedFile: (name) => `âš ï¸ SÃºbor ${name} je vo formÃ¡te HEIC, ktorÃ½ nie je podporovanÃ½.`,
        tooLarge: (name) => `âš ï¸ SÃºbor ${name} je vÃ¤ÄÅ¡Ã­ ako 5MB.`,
        uploading: (name) => `â³ NahrÃ¡vam ${name}...`,
        uploaded: (name) => `âœ… SÃºbor ${name} bol ÃºspeÅ¡ne nahratÃ½!`,
        uploadFailed: (name, error) => `âŒ NahrÃ¡vanie sÃºboru ${name} zlyhalo: ${error}`,
        allSuccess: 'ðŸŽ‰ VÅ¡etky sÃºbory boli ÃºspeÅ¡ne nahratÃ©!',
        toggleText: 'Switch to English',
        toggleFlag: 'ðŸ‡¬ðŸ‡§',
      },
      en: {
        uploadButton: 'Upload',
        heading: 'Upload your wedding photo',
        chooseFile: 'ðŸ“‚ Please choose at least one photo.',
        unsupportedFile: (name) => `âš ï¸ File ${name} is HEIC and not supported.`,
        tooLarge: (name) => `âš ï¸ File ${name} is larger than 5MB.`,
        uploading: (name) => `â³ Uploading ${name}...`,
        uploaded: (name) => `âœ… File ${name} uploaded successfully!`,
        uploadFailed: (name, error) => `âŒ Upload failed for file ${name}: ${error}`,
        allSuccess: 'ðŸŽ‰ All files uploaded successfully!',
        toggleText: 'PrepnÃºÅ¥ do slovenÄiny',
        toggleFlag: 'ðŸ‡¸ðŸ‡°',
      }
    };

    const langToggle = document.getElementById('langToggle');
    const langText = document.getElementById('langText');
    const currentFlag = langToggle.querySelector('span.flag');
    const uploadBtn = document.getElementById('uploadBtn');
    const heading = document.getElementById('heading');
    const status = document.getElementById('status');

    // Update UI language and toggle button to show the *other* language option
    function updateLanguage() {
      const t = texts[lang];
      uploadBtn.textContent = t.uploadButton;
      heading.textContent = t.heading;
      langText.textContent = t.toggleText;
      currentFlag.textContent = t.toggleFlag;
      status.innerHTML = ''; // clear statuses on language switch
    }

    langToggle.addEventListener('click', () => {
      lang = lang === 'en' ? 'sk' : 'en';
      updateLanguage();
    });

    updateLanguage();

    uploadBtn.addEventListener('click', async () => {
      const files = document.getElementById('fileInput').files;
      status.innerHTML = '';

      if (!files.length) {
        status.textContent = texts[lang].chooseFile;
        return;
      }

      const maxSize = 10 * 1024 * 1024; // 10MB max size
      let successCount = 0;

      for (const file of files) {
        if (file.type === "image/heic" || file.name.toLowerCase().endsWith(".heic")) {
          status.insertAdjacentHTML('afterbegin', `<div>${texts[lang].unsupportedFile(file.name)}</div>`);
          continue;
        }
        if (file.size > maxSize) {
          status.insertAdjacentHTML('afterbegin', `<div>${texts[lang].tooLarge(file.name)}</div>`);
          continue;
        }

        status.insertAdjacentHTML('afterbegin', `<div>${texts[lang].uploading(file.name)}</div>`);

        const fileName = Date.now() + '-' + file.name;
        const storageRef = ref(storage, 'uploads/' + fileName);

        try {
          await uploadBytes(storageRef, file);
          successCount++;
          status.insertAdjacentHTML('afterbegin', `<div>${texts[lang].uploaded(file.name)}</div>`);
        } catch (error) {
          status.insertAdjacentHTML('afterbegin', `<div>${texts[lang].uploadFailed(file.name, error.message)}</div>`);
        }
      }

      if (successCount === files.length) {
        status.innerHTML = `<div style="font-weight:bold; font-size:1.1rem; color:green; display:flex; align-items:center; gap:8px;">âœ…
